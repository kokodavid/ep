function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{UFcY:function(e,t,n){"use strict";n.r(t);var a=n("ofXK"),r=n("3Pt+"),i=n("tyNb"),s=n("TEn/"),o=n("mrSG"),c=n("lGQG"),l=n("te5A"),d=n("m/P+"),u=n("wd/R"),m=n("B7Rs"),h=n("FAH8"),p=n("9HCY"),f=n("IfdK"),v=n("5zL6"),g=n("3LUQ"),_=n("xG9w"),x=n("fXoL"),y=n("tk/3");function b(e,t){if(1&e&&(x["\u0275\u0275elementStart"](0,"ion-avatar",15),x["\u0275\u0275element"](1,"img",16),x["\u0275\u0275elementEnd"]()),2&e){var n=x["\u0275\u0275nextContext"]();x["\u0275\u0275advance"](1),x["\u0275\u0275propertyInterpolate"]("src",n.assets,x["\u0275\u0275sanitizeUrl"])}}function w(e,t){1&e&&(x["\u0275\u0275elementStart"](0,"ion-avatar",15),x["\u0275\u0275element"](1,"ion-icon",17),x["\u0275\u0275elementEnd"]())}function k(e,t){if(1&e&&(x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275elementStart"](1,"ion-select-option",18),x["\u0275\u0275text"](2),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;x["\u0275\u0275advance"](1),x["\u0275\u0275propertyInterpolate"]("value",n),x["\u0275\u0275advance"](1),x["\u0275\u0275textInterpolate"](n)}}function S(e,t){if(1&e&&(x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275elementStart"](1,"ion-select-option",18),x["\u0275\u0275text"](2),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;x["\u0275\u0275advance"](1),x["\u0275\u0275propertyInterpolate"]("value",n.term_name),x["\u0275\u0275advance"](1),x["\u0275\u0275textInterpolate"](n.term_name)}}function E(e,t){1&e&&(x["\u0275\u0275elementStart"](0,"ion-list"),x["\u0275\u0275element"](1,"br"),x["\u0275\u0275element"](2,"ion-spinner",19),x["\u0275\u0275elementEnd"]())}function C(e,t){1&e&&(x["\u0275\u0275elementStart"](0,"ion-list"),x["\u0275\u0275elementStart"](1,"ion-item"),x["\u0275\u0275text"](2,"No cbc report cards for this student"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]())}function I(e,t){if(1&e){var n=x["\u0275\u0275getCurrentView"]();x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275elementStart"](1,"div"),x["\u0275\u0275elementStart"](2,"ion-item",20),x["\u0275\u0275listener"]("click",(function(){x["\u0275\u0275restoreView"](n);var e=t.$implicit;return x["\u0275\u0275nextContext"](2).cbcClick(e)})),x["\u0275\u0275elementStart"](3,"ion-col",21),x["\u0275\u0275elementStart"](4,"strong"),x["\u0275\u0275text"](5,"Class Name"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275element"](6,"br"),x["\u0275\u0275text"](7),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](8,"ion-col",22),x["\u0275\u0275elementStart"](9,"strong"),x["\u0275\u0275text"](10,"Term"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275element"](11,"br"),x["\u0275\u0275text"](12),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](13,"ion-col",22),x["\u0275\u0275elementStart"](14,"strong"),x["\u0275\u0275text"](15,"Exam"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275element"](16,"br"),x["\u0275\u0275text"](17),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()}if(2&e){var a=t.$implicit;x["\u0275\u0275advance"](7),x["\u0275\u0275textInterpolate1"](" ",a.class_name," "),x["\u0275\u0275advance"](5),x["\u0275\u0275textInterpolate1"](" ",a.term_name,""),x["\u0275\u0275advance"](5),x["\u0275\u0275textInterpolate1"](" ",a.exam_type,"")}}function O(e,t){if(1&e&&(x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275template"](1,I,18,3,"div",9),x["\u0275\u0275elementEnd"]()),2&e){var n=x["\u0275\u0275nextContext"]();x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngForOf",n.cbc_reports)}}function j(e,t){if(1&e){var n=x["\u0275\u0275getCurrentView"]();x["\u0275\u0275elementStart"](0,"ion-fab",23),x["\u0275\u0275listener"]("click",(function(){return x["\u0275\u0275restoreView"](n),x["\u0275\u0275nextContext"]().addfeed()})),x["\u0275\u0275elementStart"](1,"ion-fab-button",24),x["\u0275\u0275element"](2,"ion-icon",25),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()}}var A,P=((A=function(){function e(t,n,a,r,i,s,o,c,l,d,u,m){var h=this;_classCallCheck(this,e),this.transfer=t,this.spinnerDialog=n,this.file=a,this.iab=r,this.authService=i,this.route=s,this.fileOpener=o,this.router=c,this.http=l,this.env=d,this.alertService=u,this.session=m,this.hidden=!0,this.options={location:"yes",hidden:"no",clearcache:"yes",clearsessioncache:"yes",zoom:"yes",hardwareback:"yes",mediaPlaybackRequiresUserAction:"no",shouldPauseOnSuspend:"no",closebuttoncaption:"Close",disallowoverscroll:"no",toolbar:"yes",enableViewportScale:"no",allowInlineMediaPlayback:"no",presentationstyle:"pagesheet",fullscreen:"yes"},this.reportcards=new Array,this.exams=new Array,this.assessments=new Array,this.schoolInfo=new Array,this.examdata=new Array,this.term=new Object,this.types=new Array,this.type=new Array,this.changes=new Array,this.term_id=new Array,this.terms=new Array,this.term_data=new Array,this.j=new Array,this.fake=1,this.class_history=new Array,this.report_cards=new Array,this.cbc_reports=new Array,this.cbcdata=new Array,this.reports=new Array,setTimeout((function(){h.fake=0}),5e3),this.schoolDetails=new Object,this.examTypes=new Array,this.route.queryParams.subscribe((function(e){h.router.getCurrentNavigation().extras.state&&(h.student=h.router.getCurrentNavigation().extras.state.details,console.log(h.student),h.term_id=h.router.getCurrentNavigation().extras.state.tids,h.assets=null===h.student.student_image?1:"https://".concat(h.student.school,".eduweb.co.ke/assets/students/").concat(h.student.student_image),h.url="https://".concat(h.student.school,".eduweb.co.ke/assets/students/"),h.cdn="https://".concat(h.student.school,".eduweb.co.ke/assets/reportcards/").concat(h.student.school,"/")),h.session.sessionTimeOut()})),this.segment="reports"}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"ionViewWillEnter",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.checkFeed().then((function(e){t.feedback=e}));case 2:return e.next=4,this.authService.getSchool(this.student.school).subscribe((function(e){t.data5=e,t.schoolInfo=t.data5.data,t.schoolInfo.forEach((function(e){"School Level"==e.name&&(t.schoolLevel=e.value)}))}));case 4:return setTimeout((function(){"Secondary"===t.schoolLevel?t.authService.highCards(t.student.school,t.student.student_id).subscribe((function(e){t.data=e,console.log(t.data),t.report_cards=void 0===t.data.data?[]:t.data.data,t.report_cards=_.a(t.report_cards,"term_id").reverse()})):"Primary"===t.schoolLevel&&t.authService.cards(t.student.school,t.student.student_id).subscribe((function(e){t.data=e,t.report_cards=void 0===t.data.data?[]:t.data.data,t.report_cards=_.a(t.report_cards,"term_id").reverse()}))}),3e3),e.next=7,this.authService.currentTerm(this.student.school).subscribe((function(e){t.data2=e,t.term=t.data2.data}));case 7:return e.next=9,this.authService.schoolTerm(this.student.school,this.student.student_id).subscribe((function(e){console.log("schoool terms>> "+JSON.stringify(e)),t.term_data=e,t.terms=t.term_data.data,t.ter_id=t.terms[0].term_id,t.class_history=t.terms.map((function(e){return e.class_name})).filter((function(e,t,n){return n.indexOf(e)===t})),console.log(JSON.stringify(t.class_history)),t.class_id=t.terms[0].class_id,t.exam_mark_header=t.terms[0].class_name+t.terms[0].term_name}));case 9:return e.next=11,this.authService.examsTypes(this.student.school,this.student.class_cat_id).subscribe((function(e){t.data1=e,t.types=t.data1.nodata?[]:t.data1.data}));case 11:this.cbcreports();case 12:case"end":return e.stop()}}),e,this)})))}},{key:"view1",value:function(e){this.iab.create(e,"_blank",this.options)}},{key:"cbcreports",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.cbcreport(this.student.school,this.student.student_id).subscribe((function(e){t.cbcdata=e,t.cbc_reports=null==t.cbcdata.data?[]:t.cbcdata.data}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"calChange",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,a,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.terms[1].term_id,a=this.terms[1].class_id,e.next=3,this.authService.exams(this.student.school,a,this.student.student_id,n).subscribe((function(e){r.changes=void 0===(t=e).data?[]:t.data}));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"onlyUnique",value:function(e,t,n){return n.indexOf(e)===t}},{key:"assessment",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.authService.assessment(this.student.school,this.student.student_id).subscribe((function(e){if(t.data4=e,t.data4.nodata)t.assessments=[];else{var n=void 0===t.data4.data?[]:t.data4.data;n.sort((function(e,t){return e.term_id<t.term_id?1:-1})),t.assessments=n}}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"cbcClick",value:function(e){this.prepare(e.term_id)}},{key:"classChange",value:function(e){var t=this;this.c_id=e.target.value,"all"===this.c_id?this.terms=this.term_data.data:(this.terms=this.term_data.data,this.terms=this.terms.filter((function(e){return e.class_name==t.c_id})))}},{key:"termChange",value:function(e){this.t_id=e.target.value}},{key:"termExamChange",value:function(e){var t=this;this.ter_id=e.target.value,this.header_two=this.ter_id,this.terms.filter((function(e){e.term_name===t.ter_id&&(t.ter_id=e.term_id)}))}},{key:"classExamChange",value:function(e){var t=this,n=e.target.value;this.header_one=n,this.terms=this.term_data.data,console.log(this.terms),this.terms=this.terms.filter((function(e){if(e.class_name===n)return t.class_id=e.class_id,e.class_id==t.class_id})),console.log(this.class_id),console.log(this.terms)}},{key:"filter",value:function(){var e=this;this.report_cards=void 0===this.data.data?[]:this.data.data,this.report_cards=this.report_cards.filter((function(t){return t.term_id==e.t_id}))}},{key:"filterExam",value:function(){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.authService.presentLoading(),this.examdata=[],this.exam_mark_header="",e.next=5,this.authService.exams(this.student.school,this.class_id,this.student.student_id,this.ter_id).subscribe((function(e){t.data1=e,t.data1.nodata?(t.alertService.presentToast("No exam marks for term selected"),t.cbc_reports=[],t.authService.dismiss()):(t.data3=e,t.exams=void 0===t.data3.data?[]:t.data3.data,t.exams.forEach((function(e){t.type.push(e.exam_type)})),t.types=t.type.filter((function(e,t,n){return n.indexOf(e)===t})),t.types.forEach((function(e){console;for(var n,a=e,r=[],i=[],s=0;s<t.exams.length;s++)t.exams[s].exam_type===e&&(n=t.exams[s].mark-(void 0===t.exams[s-1]?0:t.exams[s-1].mark),r.push(t.exams[s]),i.push(n));t.examdata.push({ty:a,marks:r,change:i}),t.authService.dismiss()})))}));case 5:this.exam_mark_header=this.header_one+" "+this.header_two;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"hide",value:function(){1==this.hidden?(document.getElementById("hid").hidden=!1,this.hidden=!1):(document.getElementById("hid").hidden=!0,this.hidden=!0,this.report_cards=void 0===this.data.data?[]:this.data.data)}},{key:"prepare",value:function(e){var t;t=null!=this.student.middle_name?this.student.student_id+"_"+this.student.school+"_"+this.student.first_name+"_"+this.student.middle_name+"_"+this.student.last_name+"_"+e+".pdf":this.student.student_id+"_"+this.student.school+"_"+this.student.first_name+"__"+this.student.last_name+"_"+e+".pdf",console.log(t);var n=this.cdn+t.replace(/\s/g,"_");n.includes("'")&&(n=n.replace(/'/g,"''")),console.log(n),this.download(t,n)}},{key:"getMIMEtype",value:function(e){return{txt:"text/plain",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",pdf:"application/pdf",jpg:"image/jpeg",bmp:"image/bmp",png:"image/png",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",rtf:"application/rtf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}[e.toLowerCase()]}},{key:"open",value:function(e){var t=this;this.authService.dismiss();var n=e.split(".").reverse()[0],a=this.getMIMEtype(n);console.log(n,a,e),this.fileOpener.showOpenWithDialog(e,a).then((function(){return console.log("File is opened")})).catch((function(e){t.alertService.presentToast(e)}))}},{key:"download",value:function(e,t){return Object(o.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var a,r=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.authService.presentLoading();case 2:a=encodeURI(t),this.fileTransfer=this.transfer.create(),this.fileTransfer.download(a,this.file.dataDirectory+e,!0).then((function(e){console.log("download completed: "+e.toURL()),r.open(e.toURL())})).catch((function(t){r.authService.dismiss(),/\s/.test(e)&&r.alertService.presentToast("Download failed: File Name has spaces"),r.alertService.presentToast("Download failed: File not found"),console.log("download failed: "+JSON.stringify(t))}));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"addfeed",value:function(){this.router.navigate(["feedback"],{})}},{key:"format",value:function(e){return u(e).format("DD-MM-YYYY")}}]),e}()).\u0275fac=function(e){return new(e||A)(x["\u0275\u0275directiveInject"](m.a),x["\u0275\u0275directiveInject"](p.a),x["\u0275\u0275directiveInject"](h.a),x["\u0275\u0275directiveInject"](d.a),x["\u0275\u0275directiveInject"](c.a),x["\u0275\u0275directiveInject"](i.a),x["\u0275\u0275directiveInject"](l.a),x["\u0275\u0275directiveInject"](i.g),x["\u0275\u0275directiveInject"](y.a),x["\u0275\u0275directiveInject"](v.a),x["\u0275\u0275directiveInject"](g.a),x["\u0275\u0275directiveInject"](f.a))},A.\u0275cmp=x["\u0275\u0275defineComponent"]({type:A,selectors:[["app-cbcgrading"]],decls:34,vars:11,consts:[["color","primary"],["slot","start",2,"font-size","14px"],["text","","icon","chevron-back"],["slot","start",4,"ngIf"],[2,"text-transform","uppercase"],["size","small","disabled","",2,"color","black",3,"click"],["name","chevron-down"],["id","hid","hidden","",2,"padding-left","8px","padding-right","8px"],["id","class","cancelText","Cancel","okText","Ok",3,"ionChange"],[4,"ngFor","ngForOf"],["cancelText","Cancel","okText","Ok",3,"ionChange"],["lines","none"],["slot","end","color","dark",3,"click"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",3,"click",4,"ngIf"],["slot","start"],[3,"src"],["size","32","name","happy-outline",2,"font-size","2em"],[3,"value"],["name","lines-small","color","primary",2,"text-align","center","margin-left","50%","margin-right","50%"],[2,"margin","0px !important",3,"click"],["col-7","",2,"color","green","font-size","12px","font-weight","500"],["col-3","",2,"text-align","center !important"],["vertical","bottom","horizontal","end","slot","fixed",3,"click"],["color","tertiary"],["name","chatbox-ellipses"]],template:function(e,t){1&e&&(x["\u0275\u0275elementStart"](0,"ion-header"),x["\u0275\u0275elementStart"](1,"ion-toolbar",0),x["\u0275\u0275elementStart"](2,"ion-buttons",1),x["\u0275\u0275element"](3,"ion-back-button",2),x["\u0275\u0275text"](4,"CBC GRADES "),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](5,"ion-item"),x["\u0275\u0275template"](6,b,2,1,"ion-avatar",3),x["\u0275\u0275template"](7,w,2,0,"ion-avatar",3),x["\u0275\u0275elementStart"](8,"ion-label",4),x["\u0275\u0275text"](9),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](10,"ion-content"),x["\u0275\u0275elementStart"](11,"div"),x["\u0275\u0275elementStart"](12,"ion-list-header"),x["\u0275\u0275elementStart"](13,"ion-button",5),x["\u0275\u0275listener"]("click",(function(){return t.hide()})),x["\u0275\u0275text"](14,"Filter "),x["\u0275\u0275element"](15,"ion-icon",6),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](16,"div",7),x["\u0275\u0275elementStart"](17,"ion-item"),x["\u0275\u0275elementStart"](18,"ion-label"),x["\u0275\u0275text"](19,"Class"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](20,"ion-select",8),x["\u0275\u0275listener"]("ionChange",(function(e){return t.classExamChange(e)})),x["\u0275\u0275template"](21,k,3,2,"div",9),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](22,"ion-item"),x["\u0275\u0275elementStart"](23,"ion-label"),x["\u0275\u0275text"](24,"Term"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](25,"ion-select",10),x["\u0275\u0275listener"]("ionChange",(function(e){return t.termExamChange(e)})),x["\u0275\u0275template"](26,S,3,2,"div",9),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](27,"ion-item",11),x["\u0275\u0275elementStart"](28,"ion-button",12),x["\u0275\u0275listener"]("click",(function(){return t.filterExam()})),x["\u0275\u0275text"](29,"Filter"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275template"](30,E,3,0,"ion-list",13),x["\u0275\u0275template"](31,C,3,0,"ion-list",13),x["\u0275\u0275template"](32,O,2,1,"div",13),x["\u0275\u0275elementEnd"](),x["\u0275\u0275template"](33,j,3,0,"ion-fab",14),x["\u0275\u0275elementEnd"]()),2&e&&(x["\u0275\u0275advance"](6),x["\u0275\u0275property"]("ngIf",1!==t.assets),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf",1===t.assets),x["\u0275\u0275advance"](2),x["\u0275\u0275textInterpolate3"]("",t.student.first_name," ",t.student.middle_name," ",t.student.last_name," "),x["\u0275\u0275advance"](12),x["\u0275\u0275property"]("ngForOf",t.class_history),x["\u0275\u0275advance"](5),x["\u0275\u0275property"]("ngForOf",t.terms),x["\u0275\u0275advance"](4),x["\u0275\u0275property"]("ngIf",0===t.cbc_reports.length&&1===t.fake),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf",0===t.cbc_reports.length&&0===t.fake),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf",t.cbc_reports.length>0),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf","true"===t.feedback))},directives:[s.q,s.L,s.g,s.d,s.e,s.t,a.i,s.u,s.l,s.w,s.f,s.r,s.E,s.V,a.h,s.c,s.F,s.v,s.H,s.k,s.n,s.o],styles:["ion-segment[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-transform:unset;color:#fff;font-size:12px}ion-content[_ngcontent-%COMP%]{font-size:12px}ion-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], ion-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:#000;font-size:12px}#class[_ngcontent-%COMP%]{max-width:65%!important}ion-select[_ngcontent-%COMP%]{width:100%;justify-content:center}.center[_ngcontent-%COMP%]{text-align:right}"]}),A);n.d(t,"CbcGradingPageModule",(function(){return R}));var M,T=[{path:"",component:P}],R=((M=function e(){_classCallCheck(this,e)}).\u0275mod=x["\u0275\u0275defineNgModule"]({type:M}),M.\u0275inj=x["\u0275\u0275defineInjector"]({factory:function(e){return new(e||M)},imports:[[a.b,r.FormsModule,s.M,i.i.forChild(T)]]}),M)}}]);