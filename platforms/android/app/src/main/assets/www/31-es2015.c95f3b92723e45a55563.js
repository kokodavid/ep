(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{UFcY:function(t,e,s){"use strict";s.r(e);var n=s("ofXK"),i=s("3Pt+"),a=s("tyNb"),r=s("TEn/"),o=s("mrSG"),d=s("lGQG"),l=s("te5A"),c=s("m/P+"),h=s("wd/R"),m=s("B7Rs"),p=s("FAH8"),u=s("9HCY"),f=s("IfdK"),v=s("5zL6"),_=s("3LUQ"),g=s("xG9w"),x=s("fXoL"),b=s("tk/3");function y(t,e){if(1&t&&(x["\u0275\u0275elementStart"](0,"ion-avatar",15),x["\u0275\u0275element"](1,"img",16),x["\u0275\u0275elementEnd"]()),2&t){const t=x["\u0275\u0275nextContext"]();x["\u0275\u0275advance"](1),x["\u0275\u0275propertyInterpolate"]("src",t.assets,x["\u0275\u0275sanitizeUrl"])}}function S(t,e){1&t&&(x["\u0275\u0275elementStart"](0,"ion-avatar",15),x["\u0275\u0275element"](1,"ion-icon",17),x["\u0275\u0275elementEnd"]())}function w(t,e){if(1&t&&(x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275elementStart"](1,"ion-select-option",18),x["\u0275\u0275text"](2),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;x["\u0275\u0275advance"](1),x["\u0275\u0275propertyInterpolate"]("value",t),x["\u0275\u0275advance"](1),x["\u0275\u0275textInterpolate"](t)}}function E(t,e){if(1&t&&(x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275elementStart"](1,"ion-select-option",18),x["\u0275\u0275text"](2),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;x["\u0275\u0275advance"](1),x["\u0275\u0275propertyInterpolate"]("value",t.term_name),x["\u0275\u0275advance"](1),x["\u0275\u0275textInterpolate"](t.term_name)}}function k(t,e){1&t&&(x["\u0275\u0275elementStart"](0,"ion-list"),x["\u0275\u0275element"](1,"br"),x["\u0275\u0275element"](2,"ion-spinner",19),x["\u0275\u0275elementEnd"]())}function C(t,e){1&t&&(x["\u0275\u0275elementStart"](0,"ion-list"),x["\u0275\u0275elementStart"](1,"ion-item"),x["\u0275\u0275text"](2,"No cbc report cards for this student"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]())}function I(t,e){if(1&t){const t=x["\u0275\u0275getCurrentView"]();x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275elementStart"](1,"div"),x["\u0275\u0275elementStart"](2,"ion-item",20),x["\u0275\u0275listener"]("click",(function(){x["\u0275\u0275restoreView"](t);const s=e.$implicit;return x["\u0275\u0275nextContext"](2).cbcClick(s)})),x["\u0275\u0275elementStart"](3,"ion-col",21),x["\u0275\u0275elementStart"](4,"strong"),x["\u0275\u0275text"](5,"Class Name"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275element"](6,"br"),x["\u0275\u0275text"](7),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](8,"ion-col",22),x["\u0275\u0275elementStart"](9,"strong"),x["\u0275\u0275text"](10,"Term"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275element"](11,"br"),x["\u0275\u0275text"](12),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](13,"ion-col",22),x["\u0275\u0275elementStart"](14,"strong"),x["\u0275\u0275text"](15,"Exam"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275element"](16,"br"),x["\u0275\u0275text"](17),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit;x["\u0275\u0275advance"](7),x["\u0275\u0275textInterpolate1"](" ",t.class_name," "),x["\u0275\u0275advance"](5),x["\u0275\u0275textInterpolate1"](" ",t.term_name,""),x["\u0275\u0275advance"](5),x["\u0275\u0275textInterpolate1"](" ",t.exam_type,"")}}function O(t,e){if(1&t&&(x["\u0275\u0275elementStart"](0,"div"),x["\u0275\u0275template"](1,I,18,3,"div",9),x["\u0275\u0275elementEnd"]()),2&t){const t=x["\u0275\u0275nextContext"]();x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngForOf",t.cbc_reports)}}function j(t,e){if(1&t){const t=x["\u0275\u0275getCurrentView"]();x["\u0275\u0275elementStart"](0,"ion-fab",23),x["\u0275\u0275listener"]("click",(function(){return x["\u0275\u0275restoreView"](t),x["\u0275\u0275nextContext"]().addfeed()})),x["\u0275\u0275elementStart"](1,"ion-fab-button",24),x["\u0275\u0275element"](2,"ion-icon",25),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"]()}}let A=(()=>{class t{constructor(t,e,s,n,i,a,r,o,d,l,c,h){this.transfer=t,this.spinnerDialog=e,this.file=s,this.iab=n,this.authService=i,this.route=a,this.fileOpener=r,this.router=o,this.http=d,this.env=l,this.alertService=c,this.session=h,this.hidden=!0,this.options={location:"yes",hidden:"no",clearcache:"yes",clearsessioncache:"yes",zoom:"yes",hardwareback:"yes",mediaPlaybackRequiresUserAction:"no",shouldPauseOnSuspend:"no",closebuttoncaption:"Close",disallowoverscroll:"no",toolbar:"yes",enableViewportScale:"no",allowInlineMediaPlayback:"no",presentationstyle:"pagesheet",fullscreen:"yes"},this.reportcards=new Array,this.exams=new Array,this.assessments=new Array,this.schoolInfo=new Array,this.examdata=new Array,this.term=new Object,this.types=new Array,this.type=new Array,this.changes=new Array,this.term_id=new Array,this.terms=new Array,this.term_data=new Array,this.j=new Array,this.fake=1,this.class_history=new Array,this.report_cards=new Array,this.cbc_reports=new Array,this.cbcdata=new Array,this.reports=new Array,setTimeout(()=>{this.fake=0},5e3),this.schoolDetails=new Object,this.examTypes=new Array,this.route.queryParams.subscribe(t=>{this.router.getCurrentNavigation().extras.state&&(this.student=this.router.getCurrentNavigation().extras.state.details,console.log(this.student),this.term_id=this.router.getCurrentNavigation().extras.state.tids,this.assets=null===this.student.student_image?1:`https://${this.student.school}.eduweb.co.ke/assets/students/${this.student.student_image}`,this.url=`https://${this.student.school}.eduweb.co.ke/assets/students/`,this.cdn=`https://${this.student.school}.eduweb.co.ke/assets/reportcards/${this.student.school}/`),this.session.sessionTimeOut()}),this.segment="reports"}ngOnInit(){}ionViewWillEnter(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.authService.checkFeed().then(t=>{this.feedback=t}),yield this.authService.getSchool(this.student.school).subscribe(t=>{this.data5=t,this.schoolInfo=this.data5.data,this.schoolInfo.forEach(t=>{"School Level"==t.name&&(this.schoolLevel=t.value)})}),setTimeout(()=>{"Secondary"===this.schoolLevel?this.authService.highCards(this.student.school,this.student.student_id).subscribe(t=>{this.data=t,console.log(this.data),this.report_cards=void 0===this.data.data?[]:this.data.data,this.report_cards=g.a(this.report_cards,"term_id").reverse()}):"Primary"===this.schoolLevel&&this.authService.cards(this.student.school,this.student.student_id).subscribe(t=>{this.data=t,this.report_cards=void 0===this.data.data?[]:this.data.data,this.report_cards=g.a(this.report_cards,"term_id").reverse()})},3e3),yield this.authService.currentTerm(this.student.school).subscribe(t=>{this.data2=t,this.term=this.data2.data}),yield this.authService.schoolTerm(this.student.school,this.student.student_id).subscribe(t=>{console.log("schoool terms>> "+JSON.stringify(t)),this.term_data=t,this.terms=this.term_data.data,this.ter_id=this.terms[0].term_id,this.class_history=this.terms.map(t=>t.class_name).filter((t,e,s)=>s.indexOf(t)===e),console.log(JSON.stringify(this.class_history)),this.class_id=this.terms[0].class_id,this.exam_mark_header=this.terms[0].class_name+this.terms[0].term_name}),yield this.authService.examsTypes(this.student.school,this.student.class_cat_id).subscribe(t=>{this.data1=t,this.types=this.data1.nodata?[]:this.data1.data}),this.cbcreports()}))}view1(t){this.iab.create(t,"_blank",this.options)}cbcreports(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.authService.cbcreport(this.student.school,this.student.student_id).subscribe(t=>{this.cbcdata=t,this.cbc_reports=null==this.cbcdata.data?[]:this.cbcdata.data})}))}calChange(){return Object(o.a)(this,void 0,void 0,(function*(){var t,e=this.terms[1].term_id,s=this.terms[1].class_id;yield this.authService.exams(this.student.school,s,this.student.student_id,e).subscribe(e=>{this.changes=void 0===(t=e).data?[]:t.data})}))}onlyUnique(t,e,s){return s.indexOf(t)===e}assessment(){return Object(o.a)(this,void 0,void 0,(function*(){yield this.authService.assessment(this.student.school,this.student.student_id).subscribe(t=>{if(this.data4=t,this.data4.nodata)this.assessments=[];else{const t=void 0===this.data4.data?[]:this.data4.data;t.sort((t,e)=>t.term_id<e.term_id?1:-1),this.assessments=t}})}))}cbcClick(t){this.prepare(t.term_id)}classChange(t){this.c_id=t.target.value,"all"===this.c_id?this.terms=this.term_data.data:(this.terms=this.term_data.data,this.terms=this.terms.filter(t=>t.class_name==this.c_id))}termChange(t){this.t_id=t.target.value}termExamChange(t){this.ter_id=t.target.value,this.header_two=this.ter_id,this.terms.filter(t=>{t.term_name===this.ter_id&&(this.ter_id=t.term_id)})}classExamChange(t){var e=t.target.value;this.header_one=e,this.terms=this.term_data.data,console.log(this.terms),this.terms=this.terms.filter(t=>{if(t.class_name===e)return this.class_id=t.class_id,t.class_id==this.class_id}),console.log(this.class_id),console.log(this.terms)}filter(){this.report_cards=void 0===this.data.data?[]:this.data.data,this.report_cards=this.report_cards.filter(t=>t.term_id==this.t_id)}filterExam(){return Object(o.a)(this,void 0,void 0,(function*(){this.authService.presentLoading(),this.examdata=[],this.exam_mark_header="",yield this.authService.exams(this.student.school,this.class_id,this.student.student_id,this.ter_id).subscribe(t=>{this.data1=t,this.data1.nodata?(this.alertService.presentToast("No exam marks for term selected"),this.cbc_reports=[],this.authService.dismiss()):(this.data3=t,this.exams=void 0===this.data3.data?[]:this.data3.data,this.exams.forEach(t=>{this.type.push(t.exam_type)}),this.types=this.type.filter((t,e,s)=>s.indexOf(t)===e),this.types.forEach(t=>{console;const e=t;let s=[],n=[];for(var i,a=0;a<this.exams.length;a++)this.exams[a].exam_type===t&&(i=this.exams[a].mark-(void 0===this.exams[a-1]?0:this.exams[a-1].mark),s.push(this.exams[a]),n.push(i));this.examdata.push({ty:e,marks:s,change:n}),this.authService.dismiss()}))}),this.exam_mark_header=this.header_one+" "+this.header_two}))}hide(){1==this.hidden?(document.getElementById("hid").hidden=!1,this.hidden=!1):(document.getElementById("hid").hidden=!0,this.hidden=!0,this.report_cards=void 0===this.data.data?[]:this.data.data)}prepare(t){var e;e=null!=this.student.middle_name?this.student.student_id+"_"+this.student.school+"_"+this.student.first_name+"_"+this.student.middle_name+"_"+this.student.last_name+"_"+t+".pdf":this.student.student_id+"_"+this.student.school+"_"+this.student.first_name+"__"+this.student.last_name+"_"+t+".pdf",console.log(e);var s=this.cdn+e.replace(/\s/g,"_");s.includes("'")&&(s=s.replace(/'/g,"''")),console.log(s),this.download(e,s)}getMIMEtype(t){return{txt:"text/plain",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",pdf:"application/pdf",jpg:"image/jpeg",bmp:"image/bmp",png:"image/png",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",rtf:"application/rtf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}[t.toLowerCase()]}open(t){this.authService.dismiss();const e=t.split(".").reverse()[0],s=this.getMIMEtype(e);console.log(e,s,t),this.fileOpener.showOpenWithDialog(t,s).then(()=>console.log("File is opened")).catch(t=>{this.alertService.presentToast(t)})}download(t,e){return Object(o.a)(this,void 0,void 0,(function*(){yield this.authService.presentLoading();const s=encodeURI(e);this.fileTransfer=this.transfer.create(),this.fileTransfer.download(s,this.file.dataDirectory+t,!0).then(t=>{console.log("download completed: "+t.toURL()),this.open(t.toURL())}).catch(e=>{this.authService.dismiss(),/\s/.test(t)&&this.alertService.presentToast("Download failed: File Name has spaces"),this.alertService.presentToast("Download failed: File not found"),console.log("download failed: "+JSON.stringify(e))})}))}addfeed(){this.router.navigate(["feedback"],{})}format(t){return h(t).format("DD-MM-YYYY")}}return t.\u0275fac=function(e){return new(e||t)(x["\u0275\u0275directiveInject"](m.a),x["\u0275\u0275directiveInject"](u.a),x["\u0275\u0275directiveInject"](p.a),x["\u0275\u0275directiveInject"](c.a),x["\u0275\u0275directiveInject"](d.a),x["\u0275\u0275directiveInject"](a.a),x["\u0275\u0275directiveInject"](l.a),x["\u0275\u0275directiveInject"](a.g),x["\u0275\u0275directiveInject"](b.a),x["\u0275\u0275directiveInject"](v.a),x["\u0275\u0275directiveInject"](_.a),x["\u0275\u0275directiveInject"](f.a))},t.\u0275cmp=x["\u0275\u0275defineComponent"]({type:t,selectors:[["app-cbcgrading"]],decls:34,vars:11,consts:[["color","primary"],["slot","start",2,"font-size","14px"],["text","","icon","chevron-back"],["slot","start",4,"ngIf"],[2,"text-transform","uppercase"],["size","small","disabled","",2,"color","black",3,"click"],["name","chevron-down"],["id","hid","hidden","",2,"padding-left","8px","padding-right","8px"],["id","class","cancelText","Cancel","okText","Ok",3,"ionChange"],[4,"ngFor","ngForOf"],["cancelText","Cancel","okText","Ok",3,"ionChange"],["lines","none"],["slot","end","color","dark",3,"click"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",3,"click",4,"ngIf"],["slot","start"],[3,"src"],["size","32","name","happy-outline",2,"font-size","2em"],[3,"value"],["name","lines-small","color","primary",2,"text-align","center","margin-left","50%","margin-right","50%"],[2,"margin","0px !important",3,"click"],["col-7","",2,"color","green","font-size","12px","font-weight","500"],["col-3","",2,"text-align","center !important"],["vertical","bottom","horizontal","end","slot","fixed",3,"click"],["color","tertiary"],["name","chatbox-ellipses"]],template:function(t,e){1&t&&(x["\u0275\u0275elementStart"](0,"ion-header"),x["\u0275\u0275elementStart"](1,"ion-toolbar",0),x["\u0275\u0275elementStart"](2,"ion-buttons",1),x["\u0275\u0275element"](3,"ion-back-button",2),x["\u0275\u0275text"](4,"CBC GRADES "),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](5,"ion-item"),x["\u0275\u0275template"](6,y,2,1,"ion-avatar",3),x["\u0275\u0275template"](7,S,2,0,"ion-avatar",3),x["\u0275\u0275elementStart"](8,"ion-label",4),x["\u0275\u0275text"](9),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](10,"ion-content"),x["\u0275\u0275elementStart"](11,"div"),x["\u0275\u0275elementStart"](12,"ion-list-header"),x["\u0275\u0275elementStart"](13,"ion-button",5),x["\u0275\u0275listener"]("click",(function(){return e.hide()})),x["\u0275\u0275text"](14,"Filter "),x["\u0275\u0275element"](15,"ion-icon",6),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](16,"div",7),x["\u0275\u0275elementStart"](17,"ion-item"),x["\u0275\u0275elementStart"](18,"ion-label"),x["\u0275\u0275text"](19,"Class"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](20,"ion-select",8),x["\u0275\u0275listener"]("ionChange",(function(t){return e.classExamChange(t)})),x["\u0275\u0275template"](21,w,3,2,"div",9),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](22,"ion-item"),x["\u0275\u0275elementStart"](23,"ion-label"),x["\u0275\u0275text"](24,"Term"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](25,"ion-select",10),x["\u0275\u0275listener"]("ionChange",(function(t){return e.termExamChange(t)})),x["\u0275\u0275template"](26,E,3,2,"div",9),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementStart"](27,"ion-item",11),x["\u0275\u0275elementStart"](28,"ion-button",12),x["\u0275\u0275listener"]("click",(function(){return e.filterExam()})),x["\u0275\u0275text"](29,"Filter"),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275elementEnd"](),x["\u0275\u0275template"](30,k,3,0,"ion-list",13),x["\u0275\u0275template"](31,C,3,0,"ion-list",13),x["\u0275\u0275template"](32,O,2,1,"div",13),x["\u0275\u0275elementEnd"](),x["\u0275\u0275template"](33,j,3,0,"ion-fab",14),x["\u0275\u0275elementEnd"]()),2&t&&(x["\u0275\u0275advance"](6),x["\u0275\u0275property"]("ngIf",1!==e.assets),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf",1===e.assets),x["\u0275\u0275advance"](2),x["\u0275\u0275textInterpolate3"]("",e.student.first_name," ",e.student.middle_name," ",e.student.last_name," "),x["\u0275\u0275advance"](12),x["\u0275\u0275property"]("ngForOf",e.class_history),x["\u0275\u0275advance"](5),x["\u0275\u0275property"]("ngForOf",e.terms),x["\u0275\u0275advance"](4),x["\u0275\u0275property"]("ngIf",0===e.cbc_reports.length&&1===e.fake),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf",0===e.cbc_reports.length&&0===e.fake),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf",e.cbc_reports.length>0),x["\u0275\u0275advance"](1),x["\u0275\u0275property"]("ngIf","true"===e.feedback))},directives:[r.q,r.L,r.g,r.d,r.e,r.t,n.i,r.u,r.l,r.w,r.f,r.r,r.E,r.V,n.h,r.c,r.F,r.v,r.H,r.k,r.n,r.o],styles:["ion-segment[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-transform:unset;color:#fff;font-size:12px}ion-content[_ngcontent-%COMP%]{font-size:12px}ion-content[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%], ion-content[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{color:#000;font-size:12px}#class[_ngcontent-%COMP%]{max-width:65%!important}ion-select[_ngcontent-%COMP%]{width:100%;justify-content:center}.center[_ngcontent-%COMP%]{text-align:right}"]}),t})();s.d(e,"CbcGradingPageModule",(function(){return T}));const M=[{path:"",component:A}];let T=(()=>{class t{}return t.\u0275mod=x["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=x["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[n.b,i.FormsModule,r.M,a.i.forChild(M)]]}),t})()}}]);